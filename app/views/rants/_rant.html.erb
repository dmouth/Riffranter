<%
	show_user_icon = local_assigns.has_key?(:show_user_icon) ? local_assigns[:show_user_icon] : false 
%>

<div class=" shadow-box home-page-rant" style="text-align:left" data-rant-id="<%= rant.id %>" data-show-user-icon="<%= show_user_icon %>">
  <div class="header">
    <div class="title">
	    <div class="photo" style="text-align:center;width:120px;">
	      <% image_src = show_user_icon ? rant.user : rant.persona %>
	      <%= image_tag image_src.image_url(:tiny).to_s %>  
        <div style="font-size:1.3em"><%= link_to rant.persona.name, rant.persona %></div>
        <div><%= rant.persona.title %></div>
	    </div>
      <% if !show_user_icon %>
        <div style="font-size:.9em"><%= raw rant.persona.categories.collect{|c| link_to c.name, c}.to_sentence %></div>
      <% else %>
        <h1><%= link_to rant.user.name, rant.user %></h1>
      <% end %>
    </div>
		<!-- div class="rant-body" -->
	  	<p><%= rant.body %></p>
	  <!--/div -->  
	</div>       
	<div style="display:table;width:100%">
		<div style="display:table-row;width:100%">
		  <div id="rant-credit">
		    <% if !show_user_icon %>
		      By <%= link_to rant.user.full_name, rant.user %> about <%= time_ago_in_words rant.created_at %> ago.
		    <% else %>
		      About <%= time_ago_in_words rant.created_at %> ago.
		   <% end %>
		  </div>     
		  <div class="rant-controls">                        
		    <% if rant.user != current_user %>
		      <%= follow_user_link rant.user %> |
		    <% end %>
    
		    <% if !show_user_icon %>
		      <%= follow_persona_link rant.persona %> |
		    <% end %>
       
		    <!-- Controls on user's own rant -->
		    <% if current_user == rant.user and !current_user.admin? %>
		      <%= link_to 'Show', rant %> |
		      <%= link_to 'Edit', edit_rant_path(rant) %> |
		      <%= link_to 'Destroy', rant_path(rant), :confirm => 'Are you sure?', :method => :delete %>
		    <% end %>

		    <%= admin_area do %>
		      <%= link_to 'Show', rant %> |
		      <%= link_to 'Edit', edit_rant_path(rant) %> |
		      <%= link_to 'Destroy', rant, :confirm => 'Are you sure?', :method => :delete %>
		    <% end %>                  
		  </div>
		</div> 	
	</div>  
  <div class="rating">
    Rated at <%= rant.votes.average(:stars) || "0" %> after <%= pluralize(rant.votes.count, 'vote') %>.
  </div>      
  
  <% if rant.user != current_user %>
    <%= render :partial => 'rants/rating_control', :locals => {:rant => rant} %>
  <% end %>
  
     
</div>
